<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Todo App</title>

<style>
:root{
  --green:#55B28F;
  --green-soft:#E3F3ED;
  --bg:#f5f6f5;
  --text:#222;
  --sub:#777;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}

html,body{
  width:100%;
  height:100%;
  margin:0;
  background:#fff;
  overflow:hidden;
  font-family:Pretendard,-apple-system,BlinkMacSystemFont,sans-serif;
}

.app{width:100vw;height:100vh;background:#fff;position:relative;}

header{background:var(--green);color:#fff;padding:18px 16px 20px;}

.header-top{display:flex;justify-content:space-between;align-items:center;}
.menu{font-size:22px;cursor:pointer;}

.profile{
  width:48px;height:48px;border-radius:50%;
  overflow:hidden;background:#e0e0e0;
}
.profile img{width:100%;height:100%;object-fit:cover;}

h1{margin:18px 0 12px;font-size:28px;font-weight:700;}

.month-row{position:relative;}
.month-btn{font-size:16px;font-weight:600;cursor:pointer;}

.month-list{
  display:none;
  position:absolute;
  top:26px;left:0;
  background:#fff;color:#222;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.2);
  z-index:20;
}
.month-list div{
  padding:10px 14px;
  cursor:pointer;
}
.month-list div:active{background:#f0f0f0;}

.date-area{margin-top:14px;overflow:hidden;}
.date-track{display:flex;gap:8px;transition:.3s ease;}

.date{
  min-width:52px;
  padding:8px 0;
  border-radius:8px;
  background:rgba(255,255,255,.25);
  text-align:center;
  font-size:13px;
  cursor:pointer;
}
.date.active{background:#fff;color:var(--green);font-weight:700;}

main{
  background:var(--bg);
  padding:16px;
  height:calc(100vh - 210px);
  overflow-y:auto;
}

.todo{
  background:#fff;
  border-radius:12px;
  padding:14px;
  display:flex;
  justify-content:space-between;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  margin-bottom:12px;
}

.todo-left{display:flex;gap:12px;}
.todo-title{font-size:15px;font-weight:600;}
.todo-title[contenteditable]{outline:none;}
.todo-time{font-size:12px;color:var(--sub);margin-top:4px;}

.todo-actions{display:flex;gap:6px;}
.todo-actions button{
  border:none;
  background:var(--green-soft);
  color:var(--green);
  font-size:12px;
  padding:6px 10px;
  border-radius:8px;
}

.fab{
  position:fixed;
  right:24px;
  bottom:24px;
  width:56px;height:56px;
  border-radius:50%;
  background:var(--green);
  color:#fff;
  font-size:32px;
  border:none;
}

.modal{
  display:none;
  position:fixed;inset:0;
  background:rgba(0,0,0,.45);
  justify-content:center;
  align-items:center;
  z-index:100;
}
.modal-box{
  background:#fff;
  width:85%;
  border-radius:14px;
  padding:20px;
}
.modal-box input{
  width:100%;
  padding:12px;
  font-size:15px;
  border-radius:8px;
  border:1px solid #ddd;
}
.modal-box button{
  width:100%;
  margin-top:14px;
  padding:12px;
  background:var(--green);
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:15px;
}
</style>
</head>

<body>
<div class="app">

<header>
  <div class="header-top">
    <div class="menu" id="todayBtn">☰</div>
    <div class="profile">
      <img src="./images/Gemini_Generated_Image_mbllsymbllsymbll.png">
    </div>
  </div>

  <h1>Todo List</h1>

  <div class="month-row">
    <div class="month-btn" id="monthText"></div>
    <div class="month-list" id="monthList"></div>
  </div>

  <div class="date-area">
    <div class="date-track" id="dateTrack"></div>
  </div>
</header>

<main id="todoWrap"></main>
<button class="fab" id="addBtn">+</button>

<!-- 일정 추가 모달 -->
<div class="modal" id="modal">
  <div class="modal-box">
    <input id="todoInput" placeholder="오늘 할 일을 입력하세요" />
    <button id="saveTodo">등록</button>
  </div>
</div>

</div>

<script>
const dateTrack=document.getElementById('dateTrack');
const todoWrap=document.getElementById('todoWrap');
const monthText=document.getElementById('monthText');
const monthList=document.getElementById('monthList');
const todayBtn=document.getElementById('todayBtn');

let current=new Date();
let todos={};

const todayKey=current.toDateString();
todos[todayKey]=[
  {text:'아침 7시 일어나기',done:true,time:'오전 7시 04분 완료'}
];

/* 월 리스트 생성 */
function drawMonthList(){
  monthList.innerHTML='';
  for(let m=0;m<12;m++){
    const el=document.createElement('div');
    el.innerText=`${m+1}월`;
    el.onclick=()=>{
      current.setMonth(m);
      current.setDate(1);
      monthList.style.display='none';
      drawDates();
      renderTodos();
    };
    monthList.appendChild(el);
  }
}

function drawDates(){
  dateTrack.innerHTML='';
  monthText.innerText=`${current.getMonth()+1}월 ▾`;

  for(let i=-3;i<=10;i++){
    const d=new Date(current);
    d.setDate(current.getDate()+i);

    const el=document.createElement('div');
    el.className='date'+(d.toDateString()===current.toDateString()?' active':'');
    const dayName=['일','월','화','수','목','금','토'][d.getDay()];
    el.innerHTML=`${d.getDate()}<br>${dayName}`;
    el.onclick=()=>{
      current=new Date(d);
      drawDates();
      renderTodos();
    };
    dateTrack.appendChild(el);
  }
}

function renderTodos(){
  todoWrap.innerHTML='';
  const key=current.toDateString();
  (todos[key]||[]).forEach((t,i)=>{
    const el=document.createElement('div');
    el.className='todo';
    el.innerHTML=`
      <div class="todo-left">
        <input type="checkbox" ${t.done?'checked':''}
          onchange="toggleDone('${key}',${i})">
        <div>
          <div class="todo-title" contenteditable
            onblur="editTodo('${key}',${i},this.innerText)">
            ${t.text}
          </div>
          <div class="todo-time">${t.time}</div>
        </div>
      </div>
      <div class="todo-actions">
        <button onclick="focusEdit(this)">수정</button>
        <button onclick="deleteTodo('${key}',${i})">삭제</button>
      </div>`;
    todoWrap.appendChild(el);
  });
}

function toggleDone(key,i){
  const t=todos[key][i];
  t.done=!t.done;
  if(t.done){
    const n = new Date();

const hour24 = n.getHours();
const isAM = hour24 < 12;
const hour12 = hour24 % 12 || 12;
const minute = n.getMinutes().toString().padStart(2,'0');

t.time = `${isAM ? '오전' : '오후'} ${hour12}시 ${minute}분 완료`;
  }else t.time='미완료';
  renderTodos();
}
function editTodo(key,i,text){todos[key][i].text=text;}
function deleteTodo(key,i){todos[key].splice(i,1);renderTodos();}
function focusEdit(btn){
  btn.closest('.todo').querySelector('.todo-title').focus();
}

/* 오늘 이동 */
todayBtn.onclick=()=>{
  current=new Date();
  drawDates();
  renderTodos();
};

/* 월 선택 토글 */
monthText.onclick=()=>{
  monthList.style.display=
    monthList.style.display==='block'?'none':'block';
};

/* 일정 추가 */
const addBtn=document.getElementById('addBtn');
const modal=document.getElementById('modal');
const todoInput=document.getElementById('todoInput');
const saveTodo=document.getElementById('saveTodo');

addBtn.onclick=()=>{modal.style.display='flex';todoInput.focus();};
saveTodo.onclick=()=>{
  const text=todoInput.value.trim();
  if(!text) return;
  const key=current.toDateString();
  todos[key]=todos[key]||[];
  todos[key].push({text,done:false,time:'미완료'});
  todoInput.value='';
  modal.style.display='none';
  renderTodos();
};
modal.onclick=e=>{if(e.target===modal)modal.style.display='none';};


// 월 선택창 외부 터치 시 닫기
document.addEventListener('click', (e) => {
  if (
    monthList.style.display === 'block' &&
    !monthList.contains(e.target) &&
    !monthText.contains(e.target)
  ) {
    monthList.style.display = 'none';
  }
});


drawMonthList();
drawDates();
renderTodos();
</script>
</body>
</html>
